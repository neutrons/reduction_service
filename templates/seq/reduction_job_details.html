{% extends "seq/base.html" %}
{% load staticfiles %}

{% block header %}
  <link rel="stylesheet" href="{% static 'css/plotting.css' %}" type="text/css" title="no title" charset="utf-8">
  <link rel="stylesheet" href="{% static 'css/plotting_print.css' %}" type="text/css" media="print" title="no title" charset="utf-8">
  <script type="text/javascript" src="{% static 'thirdparty/d3.v3/d3.v3.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/plotting.js' %}"></script>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
   

  <script type="text/javascript">
    {% if plot_1d_id %}
    var data_to_plot = {{ plot_1d|safe }};
    
    google.load('visualization', '1', {packages: ['corechart', 'line']});
	google.setOnLoadCallback(drawBasic);

	function drawBasic() {
      var data = new google.visualization.DataTable();
      data.addColumn('number', 'DeltaE');
      data.addColumn('number', 'I');
      data.addColumn('number', 'Sig(I)');
      data.addRows(data_to_plot);
      var options = {
        hAxis: {
          title: 'DeltaE'
        },
        vAxis: {
          title: 'Intensity',
          logScale: 'true'
        },
        series: {
          1: {lineWidth: '0'}
        },
        height: 400,
        explorer: {}
      };
      var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }
    {% endif %}

  </script>  
  
  
  

 <script>
 // File preview
  function preview_pre(title, url) {
  	var windowWidth = $(window).width();
	var windowHeight = $(window).height();
  	$.ajax({
  		url: url,
  		success: function(result){
        	$("body").append('<div id="dialog-preview"><pre><code>' + result + '</code></pre></div>');
        	$("#dialog-preview").dialog({
        		title: title,
        		resizable: false,
        		maxHeight : windowHeight - 150,
				maxWidth : windowWidth -150,
				minWidth : windowWidth -250,
        		close: function( event, ui ) {$("#dialog-preview").remove();}
     		})
     		.css({overflow:"auto"});
     		$('pre code').each(function(i, block) {
     		  hljs.highlightBlock(block);
            });
    	}
    });
  };
  $(function() { $("#dialog-preview").hide(); });
  // closes the dialog when click outside
  $(document).mouseup(function(e) {
	  var alert_box = $(".ui-widget-overlay");
	  if (alert_box.has(e.target).length === 0)
	     $("#dialog-preview").dialog("close");
  });

  </script>
  
{% endblock %}

{% block content %}
    <h2>Results for <a href="{% url 'reduction_options' reduction_id=remote_job.reduction.id instrument_name=instrument %}" title='Click to see the latest version of this reduction'>
    	{% if remote_job.reduction.name|length > 0 %}{{ remote_job.reduction.name }}{% else %}reduction {{ remote_job.reduction.id }}{% endif %}</a></h2>    <div class='tiled_area'>
      <div class='tile'>
        Job {{ job_id }}
        <ul>
          <li>Status: {{ job_info.JobStatus }}</li>
          <li>Start time: {{ job_info.StartDate }}</li>
          <li>End time: {{ job_info.CompletionDate }}</li>
        </ul>
      </div>
      
      <div class='tile'>
        Reduction parameters
        <ul>
          <li>Sample data: {{ parameters.data_file }}</li>
          <li>Raw vanadium: {{ parameters.raw_vanadium }}</li>
          <li>Processed vanadium: {{ parameters.processed_vanadium }}</li>
          <li>Masked banks: {{ parameters.masked_bank }}</li>
          <li>Masked pixels: {{ parameters.masked_pixel }}</li>
          <li>Masked tubes: {{ parameters.masked_tube }}</li> 
          <li>Energy Binning :: Min:{{ parameters.energy_binning_min }} Step:{{ parameters.energy_binning_step }} Max:{{ parameters.energy_binning_max }}</li>
        </ul>
      </div>
      <div class='tile'>
        Job directory: {{ job_directory }}
        <ul>
        {% for file in job_files %}
          {% url 'remote_download' trans_id file as download_url %}
          {% if download_url %}
          <li><a href="{{ download_url }}">{{ file }}</a>&nbsp; <a title="Click to preview this file." onClick="preview_pre('{{ file }}','{{ download_url }}');"><span style='display:inline-block' class="ui-icon ui-icon-zoomin"></span></a></li>
          {% else %}
          <li>{{ file }}</li>
          {% endif %}
        {% endfor %}
        </ul>
      </div>
    </div>

	{% if plot_1d_id or plot_2d %}
    <div  class="box_area tiled_area" style="width:60%;" >    
    {% if plot_1d_id %}
  		<div id="chart_div"><div>
    {% endif %}
    </div>
    {% endif %}
{% endblock %}



